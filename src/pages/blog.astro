---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const pageTitle = "Blog";
const allPosts = (await getCollection('posts', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout pageTitle={pageTitle}>
  <div class="max-w-prose mx-auto my-8 px-4">
    <p class="text-lg leading-relaxed text-muted-foreground mb-12 italic">
      Welcome to Digital Divide, a space for thoughtful essays on culture, technology, and the intersections between.
    </p>

    {allPosts.length === 0 ? (
      <p class="text-center text-muted-foreground py-8">No blog posts yet. Check back soon!</p>
    ) : (
      <ul class="list-none p-0 m-0">
        {allPosts.map((post) => (
          <li class="mb-12 pb-8 border-b border-border last:border-b-0">
            <article>
              <div class="flex gap-4 mb-3 text-sm text-muted-foreground">
                <span class="inline-block bg-secondary text-secondary-foreground px-3 py-1 rounded text-xs font-semibold uppercase tracking-wide">
                  {post.data.category}
                </span>
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                </time>
              </div>
              <h2 class="my-3 text-2xl sm:text-3xl leading-tight">
                <a href={`/posts/${post.slug}`} class="text-foreground no-underline hover:text-primary transition-colors">
                  {post.data.title}
                </a>
              </h2>
              <p class="text-muted-foreground my-3 leading-relaxed">
                {post.data.description}
              </p>
              <a href={`/posts/${post.slug}`} class="inline-block text-primary no-underline font-medium mt-3 hover:opacity-80 transition-opacity">
                Read more â†’
              </a>
            </article>
          </li>
        ))}
      </ul>
    )}
  </div>
</BaseLayout>
